# 功能设计

## No.1

###  用户注册与登录，实现增删改查功能，底层须使用数据库保存信息；

##### 增加

```go
func SaveUser(username string, password string, email string) error {
	//写sql语句
	sqlStr := "insert into users(username,password,email) values(?,?,?)"
	//执行
	_, err := utils.Db.Exec(sqlStr, username, password, email)
	if err != nil {
		return err
	}
	return nil
}

func SaveAsAdministrator(username string, password string, email string) error {
	//写sql语句
	sqlStr := "insert into users(username,password,email,groupid) values(?,?,?,1)"
	//执行
	_, err := utils.Db.Exec(sqlStr, username, password, email)
	if err != nil {
		return err
	}
	return nil
}
```

##### 删除

```go
/*
func DeleteUser(userID string) error {
	//写sql语句
	sqlStr := "delete from users where id = ?"
	//执行
	_, err := utils.Db.Exec(sqlStr, userID)
	if err != nil {
		return err
	}
	return nil
}
*/
```

##### 修改

```go
/*
func UpdateUser(username string, password string, email string, userID int64) error {
	//写sql语句
	sqlStr := "update users set username=?,PASSWORD=?,email=? where id=?"
	//执行
	_, err := utils.Db.Exec(sqlStr, username, password, email, userID)
	if err != nil {
		return err
	}
	return nil
}
*/
```

##### 查询

```go
func GetUserInfo() ([]*model.User_chenjunjie, error) {
	//写sql语句
	sql := "select id,username,PASSWORD,email from users"
	//执行
	rows, err := utils.Db.Query(sql)
	if err != nil {
		return nil, err
	}
	var users []*model.User_chenjunjie
	for rows.Next() {
		user := &model.User_chenjunjie{}
		rows.Scan(&user.ID, &user.Username, &user.Password, &user.Email)
		users = append(users, user)
	}
	return users, nil
}
```

## No.2

###  Session的使用，实现增删改查功能，底层须使用数据库保存信息；

##### 增加

```go
func AddSession(sess *model.Session_chenjunjie) error {
	//写sql语句
	sqlStr := "insert into sessions values(?,?,?,?)"
	//执行sql
	_, err := utils.Db.Exec(sqlStr, sess.SessionID, sess.UserName, sess.UserID, sess.GroupID)
	if err != nil {
		return err
	}
	return nil
}
```

##### 删除

```go
func DeleteSession(sessID string) error {
	//写sql语句
	sqlStr := "delete from sessions where session_id = ?"
	//执行sql
	_, err := utils.Db.Exec(sqlStr, sessID)
	if err != nil {
		return err
	}
	return nil
}
```

##### 查询

```go
func GetSession(sessID string) (*model.Session_chenjunjie, error) {
	//写sql语句
	sqlStr := "select * from sessions where session_id = ?"
	//预编译
	inStmt, err := utils.Db.Prepare(sqlStr)
	if err != nil {
		return nil, err
	}
	//执行
	row := inStmt.QueryRow(sessID)
	//创建Session
	sess := &model.Session_chenjunjie{}
	//扫描数据库中的字段值为Session的字段赋值
	row.Scan(&sess.SessionID, &sess.UserName, &sess.UserID, &sess.GroupID)
	return sess, nil
}
```